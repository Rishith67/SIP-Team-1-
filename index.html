<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Schedule Planner</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header>
    <h1>Schedule Planner</h1>
  </header>
  
  <nav>
    <a href="#" onclick="showPage('home')">Home</a>
    <a href="#" onclick="showPage('login')">Login & Generate</a>
    <a href="#" onclick="showPage('timetable')">View Schedule</a>
    <a href="#" onclick="showPage('contact')">Contact Us</a>
  </nav>

  <div class="container">
    <!-- Home Page -->
    <div id="home">
      <h2>Welcome to Schedule Planner</h2>
      <p>
        Schedule Planner is a tool designed to help you generate and manage schedules efficiently. 
        Whether you're planning for classes, labs, or faculty assignments, our tool provides a simple 
        and effective way to organize your time.
      </p>
      <p>
        Use the navigation bar above to log in, generate schedules, view them, or contact us for more information.
      </p>

      <!-- Highlight Cards -->
      <div class="home-highlight">
        <div class="card">
          <h4>Generate Schedules</h4>
          <p>Create optimized schedules for your classes, labs, or faculty assignments with ease.</p>
        </div>
        <div class="card">
          <h4>View Timetables</h4>
          <p>Access and review your generated schedules in a clean and organized format.</p>
        </div>
        <div class="card">
          <h4>Contact Support</h4>
          <p>Need help? Reach out to our support team for assistance with your scheduling needs.</p>
        </div>
      </div>
    </div>

    <!-- Login Form -->
    <div id="login" style="display: none;">
      <!-- Login Section -->
      <div id="login-section">
        <form id="loginForm">
          <label for="email">Email</label>
          <input type="email" id="email" required />

          <label for="password">Password</label>
          <input type="password" id="password" required />

          <button type="submit">Login</button>
        </form>
      </div>

      <!-- Generate Section (Initially Hidden) -->
      <div id="generate-section" style="display: none;">
        <form id="timetableForm">
          <label for="sections">Total Sections</label>
          <input type="number" id="sections" value="15" required />

          <label for="sip">SIP Sections</label>
          <input type="number" id="sip" value="8" required />

          <label for="eep">EEP Sections</label>
          <input type="number" id="eep" value="7" required />

          <label for="faculty">Total Faculty</label>
          <input type="number" id="faculty" value="30" required />

          <button type="submit">Generate Schedule</button>
        </form>
      </div>
    </div>

    <!-- Schedule Output -->
    <div id="timetable" style="display: none;">
      <button onclick="downloadPDF()">Download PDF</button>
      <button onclick="downloadExcel()">Export to Excel</button>
      <div id="output" class="timetable-output">
        <!-- Timetable content will be dynamically generated here -->
      </div>
    </div>

    <!-- Contact Us Page -->
    <div id="contact"style="display: none;">
      <h2>Contact Us</h2>
      <p>If you have any questions or need assistance, feel free to reach out to us:</p>
      <ul>
        <li><span></span> <a href="https://mail.google.com/mail/u/0/?tab=rm&ogbl#inbox?compose=CllgCJvqJvdMCNDFZhdPqsRXlfWnlRdBGggnwKNMZXbxwmfspjtDCbMRhbZdLfNfRPpVWQWhwSB" class="email">support@scheduleplanner.com</a> </li>
        <li><span></span> +91 81214 81249</li>
        <li><span></span> We are here to help you make the most of your time!</li>
      </ul>
    </div>
  </div>

  <!-- Include Required Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script>
    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    const sipTimeSlots = ["10:10 - 12:10 PM", "1:00 - 3:00 PM"];
    const eepTimeSlots = ["9:10 - 12:10 PM", "12:10 - 4:00 PM (Lunch Break: 1:10 - 2:00 PM)"];

    function showPage(id) {
      const pages = ["home", "login", "timetable", "contact"];
      pages.forEach(page => {
        const el = document.getElementById(page);
        el.style.display = page === id ? "block" : "none"; // Show the selected page, hide others
        if (page === id) {
          el.classList.add("fade-in-page"); // Add fade-in animation to the visible page
        } else {
          el.classList.remove("fade-in-page"); // Remove animation from hidden pages
        }
      });
    }

    document.getElementById("loginForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      if (email !== "admin@example.com" || password !== "123456") {
        alert("Unauthorized! Incorrect credentials.");
        return;
      }

      document.getElementById("login-section").style.display = "none";
      document.getElementById("generate-section").style.display = "block";
    });

    document.getElementById("timetableForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const totalSections = parseInt(document.getElementById("sections").value);
      const sipCount = parseInt(document.getElementById("sip").value);
      const eepCount = parseInt(document.getElementById("eep").value);
      const totalFaculty = parseInt(document.getElementById("faculty").value);

      const sections = Array.from({ length: totalSections }, (_, i) => `Section ${i + 1}`);
      const sipSections = sections.slice(0, sipCount);
      const eepSections = sections.slice(sipCount, sipCount + eepCount);
      const facultyMembers = Array.from({ length: totalFaculty }, (_, i) => `Faculty ${i + 1}`);

      let timetable = {};
      days.forEach(day => (timetable[day] = []));

      let assignedFaculties = [];

      function getAvailableFaculty(assigned, all) {
        const available = all.filter(f => !assigned.includes(f));
        if (available.length === 0) return null;
        return available[Math.floor(Math.random() * available.length)];
      }

      function assignSessionToDay(section, subject, day, timeSlots) {
        const faculty = getAvailableFaculty(assignedFaculties, facultyMembers);
        if (!faculty) return false;
        const time = timeSlots[Math.floor(Math.random() * timeSlots.length)];
        timetable[day].push({ section, time, subject, faculty });
        assignedFaculties.push(faculty);
        return true;
      }

      const combinedSections = [...sipSections.map(s => ({ section: s, subject: "SIP" })), ...eepSections.map(e => ({ section: e, subject: "EEP" }))];
      let shuffledCombined = [...combinedSections].sort(() => Math.random() - 0.5);
      for (let i = 0; i < days.length; i++) {
        const day = days[i];
        const { section, subject } = shuffledCombined[i % shuffledCombined.length];
        const timeSlots = subject === "SIP" ? sipTimeSlots : eepTimeSlots;
        assignSessionToDay(section, subject, day, timeSlots);
      }

      function assignRandomSessions(sectionList, subject, timeSlots) {
        sectionList.forEach(section => {
          const alreadyAssigned = Object.values(timetable).some(dayArr =>
            dayArr.some(entry => entry.section === section && entry.subject === subject)
          );
          if (alreadyAssigned) return;

          let shuffledDays = [...days].sort(() => Math.random() - 0.5);
          for (let day of shuffledDays) {
            if (assignSessionToDay(section, subject, day, timeSlots)) break;
          }
        });
      }

      assignRandomSessions(sipSections, "SIP", sipTimeSlots);
      assignRandomSessions(eepSections, "EEP", eepTimeSlots);

      renderTimetable(timetable);
      showPage("timetable");
    });

    function renderTimetable(timetable) {
      let html = "";
      for (const day of days) {
        html += `<h3>${day}</h3>`;
        html += `<table><tr><th>Section</th><th>Time</th><th>Subject</th><th>Faculty</th></tr>`;
        timetable[day].forEach(session => {
          html += `<tr><td>${session.section}</td><td>${session.time}</td><td>${session.subject}</td><td>${session.faculty}</td></tr>`;
        });
        html += `</table>`;
      }
      document.getElementById("output").innerHTML = html;
    }

    function downloadPDF() {
      const timetableElement = document.querySelector(".timetable-output");
      html2canvas(timetableElement).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF("p", "mm", "a4");

        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

        pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
        pdf.save("timetable.pdf");
      });
    }

    function downloadExcel() {
      const timetableElement = document.querySelector(".timetable-output");
      const rows = [];
      timetableElement.querySelectorAll("table").forEach((table, index) => {
        rows.push([`Day: ${days[index]}`]); // Add day as a header
        rows.push(["Section", "Time", "Subject", "Faculty"]); // Add table headers
        table.querySelectorAll("tr").forEach(row => {
          const cells = Array.from(row.querySelectorAll("td")).map(cell => cell.textContent);
          if (cells.length > 0) rows.push(cells); // Add row data
        });
        rows.push([]); // Add an empty row between days
      });

      const ws = XLSX.utils.aoa_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Timetable");
      XLSX.writeFile(wb, "timetable.xlsx");
    }
  </script>
  <script>
    document.querySelector('.home-highlight').addEventListener('mousemove', e => {
      const cards = document.querySelectorAll('.card');
      cards.forEach(card => {
        const x = (e.clientX / window.innerWidth - 0.5) * 10;
        const y = (e.clientY / window.innerHeight - 0.5) * 10;
        card.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
      });
    });
  </script>
</body>
</html>
